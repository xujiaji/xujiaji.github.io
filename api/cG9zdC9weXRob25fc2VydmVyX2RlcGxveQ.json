{"title":"python web 从Win部署到ubuntu小记","date":"2018-05-28T07:54:30.000Z","author":"xujiaji","thumbnail":null,"slug":"python_server_deploy","comments":true,"dropcap":true,"tags":["linux","python","笔记"],"categories":["Python"],"updated":"2018-07-14T05:33:38.000Z","content":"<p>本篇文章主要是用来记录我将python后台部署到amazon ec2服务器的全过程，以及一些坑坑洼洼。希望对有需要的朋友提供帮助，并且往后也好快速回忆。我的学习地址:<a href=\"https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014323392805925d5b69ddad514511bf0391fe2a0df2b0000\" target=\"_blank\" rel=\"noopener\">廖雪峰 实战 Day15-部署Web App</a><br><a id=\"more\"></a></p>\n<h2 id=\"注册并创建Amazon-EC2实例\"><a href=\"#注册并创建Amazon-EC2实例\" class=\"headerlink\" title=\"注册并创建Amazon EC2实例\"></a>注册并创建Amazon EC2实例</h2><ol>\n<li>首先需要创建一个账号，有12 个月的免费套餐访问权限。注册流程有点麻烦，需要添加信用卡，支付1美元来认证账号(•́へ•́╬)。然后验证码居然是打电话认证，电脑上会显示验证码，随后电话来了等她说完，手机输入验证码“#”结束。到此因该都注册成功了！</li>\n<li>找到EC2启动实例，创建一个ubuntu的实例，默认创建就OK了。</li>\n<li>创建结束会让你输入一个ssh密钥的名称，你输入一个邮箱之类的就行了，随后会帮你生成一个<code>.pem</code>的私密，下载下来放好咯！这玩意儿就相当于登录密码了。</li>\n<li>编辑安全组，添加22端口和80端口的访问权限<ul>\n<li>在EC2管理界面将你创建的实例拉拉到最右边有个叫安全组的栏目，点进去<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//an_quan_zu1.png\" alt=\"\"></li>\n<li>进去后点击入站-编辑<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//an_quan_zu2.png\" alt=\"\"></li>\n<li>创建SSH入站规则，绑定自己的IP地址，第3步选了后会自动获取你的ip地址。如下图<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//an_quan_zu3.png\" alt=\"\"></li>\n<li>您还需要添加http 80端口，并且设置为任何位置都可访问，如下：<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//20180530103931.png\" alt=\"\"></li>\n</ul>\n</li>\n</ol>\n<h2 id=\"连接到服务器\"><a href=\"#连接到服务器\" class=\"headerlink\" title=\"连接到服务器\"></a>连接到服务器</h2><h3 id=\"使用-PuTTY-连接到服务器\"><a href=\"#使用-PuTTY-连接到服务器\" class=\"headerlink\" title=\"使用 PuTTY 连接到服务器\"></a>使用 PuTTY 连接到服务器</h3><ol>\n<li><a href=\"https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html\" target=\"_blank\" rel=\"noopener\">下载并安装PuTTY</a></li>\n<li>找到PuTTY安装目录，双击打开<code>puttygen.exe</code></li>\n<li>加载之前您下载的<code>.pem</code>文件，需要转换一下私密格式<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//load_pem.png\" alt=\"\"></li>\n<li>点击save进行保存<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//save_key.png\" alt=\"\"><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//server_key2.png\" alt=\"\"></li>\n<li>打开PuTTY进行配置<ol>\n<li>配置SSH<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//load_ppk.png\" alt=\"\"></li>\n<li>配置主机地址(ubuntu服务器地址前需要加上<code>ubuntu@</code>)，并保存配置。主机地址<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//server_address.png\" alt=\"\"></li>\n<li>最后输入配置名称点击保存，下次就可以直接双击已配置好的选项直接进入。<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//server_config_save.png\" alt=\"\"></li>\n<li>打开后也许也许你会发现进不去！这时你需要检查服务器<code>安全组</code>里是否添加SSH（如果最后也无法连接可把ssh来源改为任何位置试试），还有检查window防火墙是否开放22端口（可关闭防火墙试试，或在防火墙高级规则里面添加22端口访问）<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//cannot_in_server.png\" alt=\"\"></li>\n</ol>\n</li>\n</ol>\n<h3 id=\"WinSCP-管理服务器文件资源\"><a href=\"#WinSCP-管理服务器文件资源\" class=\"headerlink\" title=\"WinSCP 管理服务器文件资源\"></a>WinSCP 管理服务器文件资源</h3><ol>\n<li><a href=\"https://winscp.net/eng/download.php\" target=\"_blank\" rel=\"noopener\">下载地址</a></li>\n<li>安装时会自动检测到PuTTY的配置，选择导入<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//install_winSCP.png\" alt=\"\"><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//install_winSCP2.png\" alt=\"\"></li>\n<li>直接选中你的站点登录就OK了。</li>\n<li>也许你会遇到没有权限无法创建文件的情况<a href=\"https://blog.csdn.net/xuejinliang/article/details/52301349\" target=\"_blank\" rel=\"noopener\">winscp普通用户上传文件没有权限解决</a></li>\n</ol>\n<h2 id=\"配置python-web环境\"><a href=\"#配置python-web环境\" class=\"headerlink\" title=\"配置python web环境\"></a>配置python web环境</h2><blockquote>\n<p>接下来可以直接到这里去看部署过程了 <a href=\"https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014323392805925d5b69ddad514511bf0391fe2a0df2b0000\" target=\"_blank\" rel=\"noopener\">廖雪峰 Python Day 15 - 部署Web App</a></p>\n</blockquote>\n<ol>\n<li>此时我们通过PuTTY登录服务器，我们输入python，会发现进入的是python2的版本<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//python_version1.png\" alt=\"\"></li>\n<li>我们需要安装python 3.6的版本，注意我们不要直接<code>apt-get install python3</code>，这样会直接安装成3.5的版本，然而aiomysql这个库不支持，折腾了许久。pip3也需要自己手动去安装的。</li>\n<li><a href=\"https://www.cnblogs.com/weiyiming007/p/9075986.html\" target=\"_blank\" rel=\"noopener\">Ubuntu16.04安装Python3.6 和pip</a></li>\n<li>安装<code>Nginx</code>丶<code>Supervisor</code>丶<code>MySQL</code>命令：<code>$ sudo apt-get install nginx supervisor mysql-server</code><ul>\n<li>mysql安装的时候需要配置密码，密码得记好了</li>\n<li>编辑mysql配置文件设置utf8编码，输入命令：<code>vim /etc/mysql/my.cnf</code></li>\n<li><code>i</code>进入输入模式，添加下面配置, <code>Esc</code>进入命令模式 <code>:wq</code>进行保存退出</li>\n<li>重启MySQL<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[client]</span><br><span class=\"line\">default-character-set = utf8</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">default-storage-engine = INNODB</span><br><span class=\"line\">character-set-server = utf8</span><br><span class=\"line\">collation-server = utf8_general_ci</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ol>\n<p>5.将sql建数据库和表的配置文件传到服务器运行：<code>$ mysql -u root -p &lt; schema.sql</code><br><br>6.通过Navicat连接服务器数据库，这里的配置就跟本地的配置一样的，密码就是数据库的密码。然后我们去配置SSH<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//navicat_config1.png\" alt=\"\"><br>ip地址就是之前我们在网页后台看到的地址，端口号默认的22，选择公钥验证，私密选择我们之前用<code>puttygen.exe</code>导出的<code>.ppk</code>文件，密码短语就是创建服务器后创建的密钥名称（可以在EC2网页后台看到密钥名称这一栏）<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//navicat_config2.png\" alt=\"\"><br>这下就爽了<br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//navicat_config3.png\" alt=\"\"><br><br>7.安装Web App用到的python库，命令：<code>$ sudo pip3 install jinja2 aiomysql aiohttp</code></p>\n<h2 id=\"部署\"><a href=\"#部署\" class=\"headerlink\" title=\"部署\"></a>部署</h2><ol>\n<li>安装自动化部署工具Fabric，命令：<code>pip3 install fabric3</code></li>\n<li>此处都可以去看<a href=\"https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014323392805925d5b69ddad514511bf0391fe2a0df2b0000\" target=\"_blank\" rel=\"noopener\">廖老师所讲的部署</a>，因为教程是安装的python2环境下的fabric所以在这里绕了很久。</li>\n<li>配置的时候我们配置验证的时候我们可以直接用ssh来进行验证，<code>env.hosts</code>就是之前我们配置PuTTY是的主机地址，<code>env.key_filename</code>就是我们下载的ssh私密<code>.pem</code><br><img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy//fabric_config.png\" alt=\"\"></li>\n<li>我的<code>fabric</code>配置：<code>fabfile.py</code><figure class=\"highlight py\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># fabfile.py</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> os, re</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 导入Fabric API:</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> fabric.api <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务器登录用户名:</span></span><br><span class=\"line\"><span class=\"comment\"># env.user = 'ubuntu'</span></span><br><span class=\"line\"><span class=\"comment\"># sudo用户为root:</span></span><br><span class=\"line\"><span class=\"comment\"># env.sudo_user = 'ubuntu'</span></span><br><span class=\"line\"><span class=\"comment\"># 服务器地址，可以有多个，依次部署:</span></span><br><span class=\"line\">env.hosts = [<span class=\"string\">'ubuntu@ec2-18-220-216-89.us-east-2.compute.amazonaws.com'</span>]</span><br><span class=\"line\">env.key_filename = <span class=\"string\">'~/.ssh/jiajixuqqcom.pem'</span></span><br><span class=\"line\"><span class=\"comment\"># env.ssh_config_path = '~/.ssh/config'</span></span><br><span class=\"line\"><span class=\"comment\"># env.use_ssh_config = True</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 服务器MySQL用户名和口令:</span></span><br><span class=\"line\">db_user = <span class=\"string\">'root'</span></span><br><span class=\"line\">db_password = <span class=\"string\">'6Sb8qzM38'</span></span><br><span class=\"line\"></span><br><span class=\"line\">_TAR_FILE = <span class=\"string\">'dist-awesome.tar.gz'</span></span><br><span class=\"line\">_REMOTE_TMP_TAR = <span class=\"string\">'/tmp/%s'</span> % _TAR_FILE</span><br><span class=\"line\">_REMOTE_BASE_DIR = <span class=\"string\">'/srv/awesome'</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">touchfile</span><span class=\"params\">()</span>:</span>                         <span class=\"comment\"># 随便创建一个任务，用来测试</span></span><br><span class=\"line\">    run(<span class=\"string\">'touch /tmp/www.txt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">deploy</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    newdir = <span class=\"string\">'www-%s'</span> % _now()</span><br><span class=\"line\">    <span class=\"comment\"># 删除已有的tar文件:</span></span><br><span class=\"line\">    run(<span class=\"string\">'rm -f %s'</span> % _REMOTE_TMP_TAR)</span><br><span class=\"line\">    <span class=\"comment\"># 上传新的tar文件:</span></span><br><span class=\"line\">    put(<span class=\"string\">'dist/%s'</span> % _TAR_FILE, _REMOTE_TMP_TAR)</span><br><span class=\"line\">    <span class=\"comment\"># 创建新目录:</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> cd(_REMOTE_BASE_DIR):</span><br><span class=\"line\">        sudo(<span class=\"string\">'mkdir %s'</span> % newdir)</span><br><span class=\"line\">    <span class=\"comment\"># 解压到新目录:</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> cd(<span class=\"string\">'%s/%s'</span> % (_REMOTE_BASE_DIR, newdir)):</span><br><span class=\"line\">        sudo(<span class=\"string\">'tar -xzvf %s'</span> % _REMOTE_TMP_TAR)</span><br><span class=\"line\">        <span class=\"comment\"># 需要添加权限浏览器才能访问</span></span><br><span class=\"line\">        sudo(<span class=\"string\">'chmod -R 775 static/'</span>)</span><br><span class=\"line\">        sudo(<span class=\"string\">'chmod 775 favicon.ico'</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 由于app.py的文件格式有问题，转换一下</span></span><br><span class=\"line\">        run(<span class=\"string\">'dos2unix app.py'</span>)</span><br><span class=\"line\">    <span class=\"comment\"># 重置软链接:</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> cd(_REMOTE_BASE_DIR):</span><br><span class=\"line\">        sudo(<span class=\"string\">'rm -f www'</span>)</span><br><span class=\"line\">        sudo(<span class=\"string\">'ln -s %s www'</span> % newdir)</span><br><span class=\"line\">        sudo(<span class=\"string\">'chown ubuntu:ubuntu www'</span>)</span><br><span class=\"line\">        sudo(<span class=\"string\">'chown -R ubuntu:ubuntu %s'</span> % newdir)</span><br><span class=\"line\">    <span class=\"comment\"># 重启Python服务和nginx服务器:</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> settings(warn_only=<span class=\"keyword\">True</span>):</span><br><span class=\"line\">        sudo(<span class=\"string\">'supervisorctl stop awesome'</span>)</span><br><span class=\"line\">        sudo(<span class=\"string\">'supervisorctl start awesome'</span>)</span><br><span class=\"line\">        sudo(<span class=\"string\">'/etc/init.d/nginx reload'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">build</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    includes = [<span class=\"string\">'static'</span>, <span class=\"string\">'templates'</span>, <span class=\"string\">'transwarp'</span>, <span class=\"string\">'favicon.ico'</span>, <span class=\"string\">'*.py'</span>]</span><br><span class=\"line\">    excludes = [<span class=\"string\">'test'</span>, <span class=\"string\">'.*'</span>, <span class=\"string\">'*.pyc'</span>, <span class=\"string\">'*.pyo'</span>]</span><br><span class=\"line\">    local(<span class=\"string\">'rm -f dist/%s'</span> % _TAR_FILE)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> lcd(os.path.join(os.path.abspath(<span class=\"string\">'.'</span>), <span class=\"string\">'www'</span>)):</span><br><span class=\"line\">        cmd = [<span class=\"string\">'tar'</span>, <span class=\"string\">'--dereference'</span>, <span class=\"string\">'-czvf'</span>, <span class=\"string\">'../dist/%s'</span> % _TAR_FILE]</span><br><span class=\"line\">        cmd.extend([<span class=\"string\">'--exclude=\\'%s\\''</span> % ex <span class=\"keyword\">for</span> ex <span class=\"keyword\">in</span> excludes])</span><br><span class=\"line\">        cmd.extend(includes)</span><br><span class=\"line\">        local(<span class=\"string\">' '</span>.join(cmd))</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"添加https\"><a href=\"#添加https\" class=\"headerlink\" title=\"添加https\"></a>添加https</h2><p>添加这个的原因嘛！就不加多少的啦！来看如何如何做吧！</p>\n<ol>\n<li>我是在阿里云上面找的一个免费版，可以在这里找到，进去后点击立即购买<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy/aliyun_ac1.png\" alt=\"\"></li>\n<li>选择免费类型，如下操作<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy/aliyun_ac2.png\" alt=\"\"></li>\n<li>然后就是需要填写一些您的个人信息和需要绑定的域名，比如我绑定：<code>www.xujiaji.com</code>，提交审核。（此时可能需要等个半个来小时审核）</li>\n<li>点击下载<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy/aliyun_ac_3.png\" alt=\"\"></li>\n<li>点击下载证书for Nginx，然后将压缩包解压得到两个文件。我们将这两个文件放到如下位置，<code>/ect/nginx/</code>是服务器nginx的安装目录，<code>cert</code>是新建的目录，就放这里面<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy/config_https1.png\" alt=\"\"></li>\n<li>然后我们编辑<code>/etc/nginx/sites-available/awesome</code>，我们将这些东西直接拷贝过来<img src=\"https://raw.githubusercontent.com/xujiaji/xujiaji.github.io/pictures/blog/python-web-deploy/config_https2.png\" alt=\"\"></li>\n<li>重启nginx：<code>sudo /etc/init.d/nginx reload</code></li>\n<li>配置完成后您可能还是无法访问https（我就在这纠结了半天），注意需要在服务器安全组添加所有用户对<code>443</code>端口的访问权限。</li>\n<li>下面是我的nginx整体配置代码，含义请看注释<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    # 监听80端口，作用是将用户http的请求转发到https</span><br><span class=\"line\">    listen      80;</span><br><span class=\"line\">    # 绑定的域名</span><br><span class=\"line\">    server_name www.xujiaji.com;</span><br><span class=\"line\">    rewrite ^(.*)$  https://www.xujiaji.com permanent;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    #listen      80;</span><br><span class=\"line\">    # 下面这部分就是从阿里云下载AC认证那里直接拷贝过来的配置</span><br><span class=\"line\">    listen 443;</span><br><span class=\"line\">    ssl on;</span><br><span class=\"line\">    ssl_certificate   cert/214731123750166.pem;</span><br><span class=\"line\">    ssl_certificate_key  cert/214731123750166.key;</span><br><span class=\"line\">    ssl_session_timeout 5m;</span><br><span class=\"line\">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class=\"line\">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">    ssl_prefer_server_ciphers on;    </span><br><span class=\"line\"></span><br><span class=\"line\">    # 代理的服务器根目录 日志</span><br><span class=\"line\">    root       /srv/awesome/www;</span><br><span class=\"line\">    access_log /srv/awesome/log/access_log;</span><br><span class=\"line\">    error_log  /srv/awesome/log/error_log;</span><br><span class=\"line\"></span><br><span class=\"line\">    server_name www.xujiaji.com;</span><br><span class=\"line\"></span><br><span class=\"line\">    client_max_body_size 1m;</span><br><span class=\"line\"></span><br><span class=\"line\">    gzip            on;</span><br><span class=\"line\">    gzip_min_length 1024;</span><br><span class=\"line\">    gzip_buffers    4 8k;</span><br><span class=\"line\">    gzip_types      text/css application/x-javascript application/json;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile on;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /favicon.ico &#123;</span><br><span class=\"line\">        root /srv/awesome/www;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ ^\\/static\\/.*$ &#123;</span><br><span class=\"line\">        root /srv/awesome/www;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        proxy_pass       http://127.0.0.1:9000;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header Host $host;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n","prev":{"title":"Dagger2 的深入分析与使用","slug":"learn-dagger"},"next":{"title":"Android 无缝换肤深入了解与使用","slug":"android-skin"},"link":"https://blog.xujiaji.com/post/python_server_deploy/","toc":[{"title":"注册并创建Amazon EC2实例","id":"注册并创建Amazon-EC2实例","index":"1"},{"title":"连接到服务器","id":"连接到服务器","index":"2","children":[{"title":"使用 PuTTY 连接到服务器","id":"使用-PuTTY-连接到服务器","index":"2.1"},{"title":"WinSCP 管理服务器文件资源","id":"WinSCP-管理服务器文件资源","index":"2.2"}]},{"title":"配置python web环境","id":"配置python-web环境","index":"3"},{"title":"部署","id":"部署","index":"4"},{"title":"添加https","id":"添加https","index":"5"}],"copyright":{"author":"xujiaji","link":"<a href=\"https://blog.xujiaji.com/post/python_server_deploy/\" title=\"python web 从Win部署到ubuntu小记\">https://blog.xujiaji.com/post/python_server_deploy/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2018年5月28日"},"reward":true}