{"title":"Android-UI事件传递就是这么个事儿","date":"2016-04-16T07:31:00.000Z","author":"xujiaji","link":"post/android-ui-event","comments":true,"tags":["Android","View"],"categories":["Android"],"updated":"2019-04-08T06:55:13.177Z","content":"<blockquote>\n<p>我们寻找的，也只不过是内心世界的片刻安宁，<br>以及，那样一场盛大的清欢。</p>\n</blockquote>\n<h2 id=\"聊聊UI事件传递\">聊聊UI事件传递<a href=\"post/android-ui-event#聊聊UI事件传递\"></a></h2><div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/ui-event.png\" alt=\"Android UI事件传递.png\" data-zoomable=\"\"></p></div>\n<h2 id=\"什么是UI事件？\">什么是UI事件？<a href=\"post/android-ui-event#什么是UI事件？\"></a></h2><ul>\n<li>触摸屏幕中UI控件的那一刻即为事件发生</li>\n<li>MotionEvent对象包含了所有的触摸事件，如<code>触摸的位置、多指触摸等</code></li>\n<li>MotionEvent描述了当前的操作类型，以下为常见类型(数字代表对应的值)：<ul>\n<li><code>ACTION_DOWN = 0</code> 按下</li>\n<li><code>ACTION_UP = 1</code> 抬起</li>\n<li><code>ACTION_MOVE = 2</code> 移动</li>\n<li><code>ACTION_CANCEL = 3</code> 动作取消</li>\n<li><code>ACTION_OUTSIDE = 4</code>  动作超出边界</li>\n<li><code>ACTION_POINTER_DOWN = 5</code> 已有一个点被按住，此时再按下一个点</li>\n<li><code>ACTION_POINTER_UP = 6</code> 多个点被按住，非最后放开的点都会调用</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"事件如何传递？\">事件如何传递？<a href=\"post/android-ui-event#事件如何传递？\"></a></h2><blockquote>\n<p>自定义的父布局和子布局，用来观察事件的变化(View1和Button1为自定义View和自定义Button，默认以自定义View1举例</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/1.png\" alt=\"1\" data-zoomable=\"\"></p></div>\n<p>上图简略关系如下：<br><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/2.png\" alt=\"布局简略关系.png\"></p>\n<p><strong>×</strong> 之前一直以为事件是从子布局开始传递到父布，因为以直观的角度我们先碰到的是子布局<code>得到错误的事件顺序：view1 --&gt; ViewGroup2 --&gt; ViewGroup1</code></p>\n<p><strong>√</strong> 后来才知道事件是从父布局传递到子布局，是由父布局判断点击位置上面有子布局然后向子布局传递。如果事件向子布局传递没有被拦截和消费，那么事件又会向父布局传递。<code>正确的没有被拦截和消费的事件顺序：Activity --&gt; ViewGroup1 --&gt; ViewGroup2 --&gt; View1 --&gt; ViewGroup2 --&gt; ViewGroup1 --&gt; Activity</code></p>\n<pre><code>以下的Log为当手指对view1点击、滑动、抬起时，\n发生的一系列事件传递（0.按下；1.抬起； 2.移动）：\n</code></pre><p>-<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------- dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------- onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------- dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------- onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/View1: ------------------ dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/View1: ------------------ onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------- onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------- onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/MainActivity: ----------- dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/MainActivity: ----------- onTouchEvent = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><code>观察</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>可以看出事件由外层大布局到内部子布局传进去，在从子布局传出去（Activity --&gt; ViewGroup1 --&gt; ViewGroup2 --&gt; View1 --&gt; ViewGroup2 --&gt; ViewGroup1 --&gt; Activity）</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>由此log还可以看出：当按下的事件没有被拦截，那么所有状态的事件都由Activity进行处理</code></td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<p>没有拦截事件时</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/3.png\" alt=\"没有拦截事件时.png\" data-zoomable=\"\"></p></div>\n<h2 id=\"如何拦截？\">如何拦截？<a href=\"post/android-ui-event#如何拦截？\"></a></h2><ul>\n<li>通过dispatchTouchEvent对事件进行拦截，<strong>当返回值为<code>true</code>的时候拦截事件</strong></li>\n<li><p>拦截后事件将不会传到子布局</p>\n<pre><code>现在以ViewGroup1为例：\n让ViewGroup1中的dispatchTouchEvent直接返回true\n当手指对View1点击、移动、抬起时\n发生的一系列事件传递（0.按下；1.抬起； 2.移动）\n</code></pre>   <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><code>观察</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>可以看出事件传递到ViewGroup1后被拦截，没有被任何布局消费</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>也就是说事件还没被消费就被拦截会导致触摸无效</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>我们可以在dispatchTouchEvent判断哪些情况需要拦截，哪些不需要拦截就放事件过去（以上直接返回了true拦截了所有情况的事件）</code></td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<p>拦截ViewGroup1的所有事件</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/4.png\" alt=\"拦截ViewGroup1的所有事件.png\" data-zoomable=\"\"></p></div>\n<h2 id=\"如何获取？\">如何获取？<a href=\"post/android-ui-event#如何获取？\"></a></h2><ul>\n<li>通过onInterceptTouchEvent获取事件，<strong>当返回值为<code>true</code>的时候获取事件</strong></li>\n<li>获取事件后会调用onTouchEvent方法，调用这个方法后，如果我们设置了OnTouchListener，那么触摸监听将会被调用。<pre><code>现在以ViewGroup2为例：\n让ViewGroup2中的onInterceptTouchEvent直接返回true\n当手指对View1点击、移动、抬起时\n发生的一系列事件传递（0.按下；1.抬起； 2.移动）\n</code></pre></li>\n</ul>\n<p>-<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th><code>观察问题</code></th>\n<th style=\"text-align:center\"><code>原因</code></th>\n<th style=\"text-align:center\"><code>解决</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>哎呀呀~！为啥我获取到了的事件之后，移动和抬起手指的事件被MainActivity吃了！愤怒！！</code></td>\n<td style=\"text-align:center\"><code>原来onTouchEvent如果处理按下事件DOWN的时候没有返回true。如果onTouchEvent处理DOWN时候返回false，则表示没有消费事件，事件将会回到父布局，并且后续事件将不会再传递过来。</code></td>\n<td style=\"text-align:center\"><code>onTouchEvent方法中判断为按下DOWN事件的时候，返回true即下面要说的消费</code></td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<p>当ViewGroup2事件获取到了，但没有消费</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/5.png\" alt=\"当ViewGroup2事件获取到了，但没有消费.png\" data-zoomable=\"\"></p></div>\n<h2 id=\"如何消费？\">如何消费？<a href=\"post/android-ui-event#如何消费？\"></a></h2><ul>\n<li><p>上边已经提到过，就是获取事件遗留下来一个问题：获取到了按下事件，为啥没继续获取到后续的事件？就是因为按下时onTouchEvent没有返回true，导致事件从新回到父布局，也就是没有消费事件。</p>\n<pre><code>现在接着以ViewGroup2为例：\n还是让ViewGroup2中的onInterceptTouchEvent直接返回true\n添加：在onTouchEvent方法中添加判断if (event.getAction() == MotionEvent.ACTION_DOWN) {return true;}\n当手指对View1点击、移动、抬起时\n发生的一系列事件传递（0.按下；1.抬起； 2.移动）\n</code></pre>  <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: ----------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup1: ------------------  onInterceptTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup2: ------------------  onTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/MainActivity: ----------------  onTouchEvent = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th><code>观察</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>由上边log可以看出，现在在ViewGroup2中的onTouchEvent的按下事件返回一个true后，按下事件并没有在传递回父布局中，使得后续事件都将能得到</code></td>\n</tr>\n<tr>\n<td><code>可以看出当后续事件传递过来时，ViewGroup2已经没有再次调用onInterceptTouchEvent方法</code></td>\n</tr>\n<tr>\n<td><code>我们只是将按下DOWN的事件返回true，所以除了按下事件其他移动或抬起的事件activity都也能获取到。当onTouchEvent不管三七二十一直接返回一个true时，activity就不会获取到事件</code></td>\n</tr>\n</tbody>\n</table></div></div>\n<blockquote>\n<p>当消费ViewGroup2的按下DOWN事件时</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/6.png\" alt=\"当消费ViewGroup2的按下DOWN事件时.png\" data-zoomable=\"\"></p></div>\n<blockquote>\n<p>当ViewGroup2中onTouchEvent直接返回true时</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/7.png\" alt=\"当ViewGroup2中onTouchEvent直接返回true时.png\" data-zoomable=\"\"></p></div>\n<h2 id=\"Button获取事件是怎么回事？\">Button获取事件是怎么回事？<a href=\"post/android-ui-event#Button获取事件是怎么回事？\"></a></h2><ul>\n<li><p>现在将View1换成Button1，其他的恢复最初状态，先来看看触摸的log</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">E/MainActivity: -------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  onInterceptTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/Button1: ------------------  dispatchTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/Button1: ------------------  onTouchEvent = <span class=\"number\">0</span></span><br><span class=\"line\">E/MainActivity: -------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/Button1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/Button1: ------------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: -------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  onInterceptTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/Button1: ------------------  dispatchTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/Button1: ------------------  onTouchEvent = <span class=\"number\">2</span></span><br><span class=\"line\">E/MainActivity: -------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup1: ---------------  onInterceptTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/ViewGroup2: ---------------  onInterceptTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/Button1: ------------------  dispatchTouchEvent = <span class=\"number\">1</span></span><br><span class=\"line\">E/Button1: ------------------  onTouchEvent = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在来看看序列图</p>\n</li>\n</ul>\n<blockquote>\n<p>Button获取触摸事件</p>\n</blockquote>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/8.png\" alt=\"Button获取触摸事件.png\" data-zoomable=\"\"></p></div>\n<ul>\n<li><p>这一看，这不是和上面那张图<code>当ViewGroup2中onTouchEvent直接返回true时</code>的效果一样的吗？也就是说button默认就是直接获取了事件，没有让事件返回主布局中。</p>\n</li>\n<li><p>等等还有一个！！！大家都知道布局有个属性<strong>clickable</strong>吧！当设置它的值为true时，使得这个布局事件如button所述！</p>\n</li>\n<li><p>更深入的理解的话这里博客已经介绍的很详细了</p>\n<ul>\n<li><a href=\"http://blog.csdn.net/guolin_blog/article/details/9097463\" target=\"_blank\" rel=\"noopener\">Android事件分发机制完全解析，带你从源码的角度彻底理解(上)</a></li>\n<li><a href=\"http://blog.csdn.net/guolin_blog/article/details/9153747\" target=\"_blank\" rel=\"noopener\">Android事件分发机制完全解析，带你从源码的角度彻底理解(下)</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"实际的应用\">实际的应用<a href=\"post/android-ui-event#实际的应用\"></a></h2><p>-<br>来一个简单的应用</p>\n<p>xml布局<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">LinearLayout</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"vertical\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">android:padding</span>=<span class=\"string\">\"10dp\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">CheckBox</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/checkbox_lock\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:text</span>=<span class=\"string\">\"Lock Selection\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">RadioGroup</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:orientation</span>=<span class=\"string\">\"horizontal\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RadioButton</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/selection_first\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"0dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:text</span>=<span class=\"string\">\"First\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RadioButton</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/selection_second\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"0dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:text</span>=<span class=\"string\">\"Second\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RadioButton</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/selection_third\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"0dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:layout_weight</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:text</span>=<span class=\"string\">\"Third\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">RadioGroup</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>activity代码<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.examples.customtouch;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> android.app.Activity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.os.Bundle;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.util.Log;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.view.MotionEvent;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.view.View;</span><br><span class=\"line\"><span class=\"keyword\">import</span> android.widget.CheckBox;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Created by Dave Smith</span></span><br><span class=\"line\"><span class=\"comment\"> * Double Encore, Inc.</span></span><br><span class=\"line\"><span class=\"comment\"> * Date: 9/25/12</span></span><br><span class=\"line\"><span class=\"comment\"> * TouchListenerActivity</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TouchListenerActivity</span> <span class=\"keyword\">extends</span> <span class=\"title\">Activity</span> <span class=\"keyword\">implements</span> <span class=\"title\">View</span>.<span class=\"title\">OnTouchListener</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Views to display last seen touch event */</span></span><br><span class=\"line\">    CheckBox mLockBox;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate(savedInstanceState);</span><br><span class=\"line\">        setContentView(R.layout.touch_listener);</span><br><span class=\"line\"></span><br><span class=\"line\">        mLockBox = (CheckBox) findViewById(R.id.checkbox_lock);</span><br><span class=\"line\"></span><br><span class=\"line\">        findViewById(R.id.selection_first).setOnTouchListener(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        findViewById(R.id.selection_second).setOnTouchListener(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        findViewById(R.id.selection_third).setOnTouchListener(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouch</span><span class=\"params\">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * Consume the events here so the buttons cannot process them</span></span><br><span class=\"line\"><span class=\"comment\">         * if the CheckBox in the UI is checked</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        Log.e(<span class=\"string\">\"TouchListenerActivity\"</span>, getNameForEvent(event));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mLockBox.isChecked();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        Log.e(<span class=\"string\">\"onTouchEvent\"</span>, getNameForEvent(event));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">super</span>.onTouchEvent(event);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">getNameForEvent</span><span class=\"params\">(MotionEvent event)</span> </span>&#123;</span><br><span class=\"line\">        String action = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (event.getAction()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_DOWN:</span><br><span class=\"line\">                action = <span class=\"string\">\"ACTION_DOWN\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_CANCEL:</span><br><span class=\"line\">                action = <span class=\"string\">\"ACTION_CANCEL\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_MOVE:</span><br><span class=\"line\">                action = <span class=\"string\">\"ACTION_MOVE\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_UP:</span><br><span class=\"line\">                action = <span class=\"string\">\"ACTION_UP\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> String.format(<span class=\"string\">\"%s\\n%.1f, %.1f\"</span>, action, event.getX(), event.getY());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<div class=\"article-img\"><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/android-ui-event/9.png\" alt=\"效果图\" data-zoomable=\"\"></p></div>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th style=\"text-align:center\"><code>状态</code></th>\n<th style=\"text-align:center\"><code>描述</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>当Lock Selection没有勾选时</code></td>\n<td style=\"text-align:center\"><code>下边的单选能正常选择</code></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>当Lock Selection勾选时</code></td>\n<td style=\"text-align:center\"><code>下边的单选无法点击</code></td>\n</tr>\n</tbody>\n</table></div></div>\n<ul>\n<li>大家是否疑惑了，为什么复选框选中状态，ontouch返回了true反而不能点击了。为什么不是返回false无法点击，返回true时才能点击呢？其实这些控件默认可以点击的都是默认获取事件的，如上面说的button为什么获取事件一样，所以返回true和false和预想的结果相反。</li>\n</ul>\n<h1 id=\"所用知识和资料\">所用知识和资料<a href=\"post/android-ui-event#所用知识和资料\"></a></h1><ol>\n<li>Android studio插件plantUml画序列图和类图</li>\n<li><a href=\"http://archive.3zso.com/archives/plantuml-quickstart.html#sec-5-3\" target=\"_blank\" rel=\"noopener\">PlantUML快速指南</a> 和 <a href=\"http://plantuml.com/classes.html\" target=\"_blank\" rel=\"noopener\">PlantUML官网</a></li>\n<li><a href=\"http://blog.csdn.net/guolin_blog/article/details/9097463\" target=\"_blank\" rel=\"noopener\">Android事件分发机制完全解析，带你从源码的角度彻底理解(上)</a><br><a href=\"http://blog.csdn.net/guolin_blog/article/details/9153747\" target=\"_blank\" rel=\"noopener\">Android事件分发机制完全解析，带你从源码的角度彻底理解(下)</a></li>\n<li><a href=\"http://a.codekk.com/detail/Android/Trinea/%E5%85%AC%E5%85%B1%E6%8A%80%E6%9C%AF%E7%82%B9%E4%B9%8B%20View%20%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92\" target=\"_blank\" rel=\"noopener\">公共技术点之 View 事件传递</a></li>\n<li><a href=\"https://github.com/devunwired/custom-touch-examples\" target=\"_blank\" rel=\"noopener\">最后的那个例子来自于这儿</a></li>\n</ol>\n","prev":{"title":"面向对象设计-里氏替换原则(LSP)","link":"post/ood-lsp"},"next":{"title":"面向对象设计-开闭原则(OCP)","link":"post/ood-ocp"},"plink":"https://blog.xujiaji.com/post/android-ui-event/","toc":[{"title":"所用知识和资料","id":"所用知识和资料","index":"1"}],"reward":true,"copyright":{"author":"xujiaji","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","link":"<a href=\"https://blog.xujiaji.com/post/android-ui-event/\" title=\"Android-UI事件传递就是这么个事儿\">https://blog.xujiaji.com/post/android-ui-event/</a>"}}