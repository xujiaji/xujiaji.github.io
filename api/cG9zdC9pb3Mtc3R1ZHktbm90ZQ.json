{"title":"iOS开发-零碎笔记","date":"2018-07-16T00:08:16.000Z","author":"xujiaji","thumbnail":"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/20190319220203.jpg","link":"post/ios-study-note","comments":true,"tags":["Swift","iOS","学习","笔记"],"categories":["iOS"],"updated":"2019-10-14T15:55:36.881Z","content":"<p>记录一些iOS学习过程中的笔记<br><a id=\"more\"></a></p>\n<h1 id=\"iOS开发-零碎笔记\">iOS开发-零碎笔记<a href=\"post/ios-study-note#iOS开发-零碎笔记\"></a></h1><h2 id=\"创建项目目录结构\">创建项目目录结构<a href=\"post/ios-study-note#创建项目目录结构\"></a></h2><ol>\n<li>AppDelegate.swift:生命周期及变量的定义</li>\n<li>ViewController.swift: MVC的C</li>\n<li>Assets.xcasset:放资源文件，如图片等</li>\n<li>info.plist：配置文件</li>\n<li>xxxTest: 单元测试</li>\n<li>Products:生成的文件</li>\n<li>Main.storyboard: 视图</li>\n</ol>\n<h2 id=\"快捷添加注释\">快捷添加注释<a href=\"post/ios-study-note#快捷添加注释\"></a></h2><figure class=\"highlight c\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">option + command + /</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"关闭软键盘\">关闭软键盘<a href=\"post/ios-study-note#关闭软键盘\"></a></h2><blockquote>\n<p>关闭代码</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">textField.resignFirstResponder()</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>关闭方式1：<br>在Controller中重写touchesEnded()方法，然后在这里面关闭软件盘，意思是点击空白处关闭</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">touchesEnded</span><span class=\"params\">(<span class=\"number\">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class=\"line\">    name.resignFirstResponder()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>关闭方式2：<br>点击下一步时，关闭软键盘；<br>Controller实现UITextFieldDelegate协议；<br>实现UITextFieldDelegate协议中的textFieldShouldReturn方法；</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textFieldShouldReturn</span><span class=\"params\">(<span class=\"number\">_</span> textField: UITextField)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    textField.resignFirstResponder()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UIDatePicker选择时间后计算年龄\">UIDatePicker选择时间后计算年龄<a href=\"post/ios-study-note#UIDatePicker选择时间后计算年龄\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">calAge</span><span class=\"params\">(by datePicker: UIDatePicker)</span></span> -&gt; <span class=\"type\">Int</span>? &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> gregorian = <span class=\"type\">NSCalendar</span>(calendarIdentifier: .gregorian)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> now = <span class=\"type\">Date</span>()</span><br><span class=\"line\">    <span class=\"keyword\">let</span> components = gregorian?.components(<span class=\"type\">NSCalendar</span>.<span class=\"type\">Unit</span>.year, from: datePicker.date, to: now, options: <span class=\"type\">NSCalendar</span>.<span class=\"type\">Options</span>.<span class=\"keyword\">init</span>(rawValue: <span class=\"number\">0</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> components?.year</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"页面跳转，传递数据\">页面跳转，传递数据<a href=\"post/ios-study-note#页面跳转，传递数据\"></a></h2><p>有两个Controller：ViewController和GalleryViewController。从ViewController跳转到GalleryViewController。<br>ViewController重写方法：prepare，该方法在页面跳转时会被调用，我们需要在里面判断是跳转到哪个页面。</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">prepare</span><span class=\"params\">(<span class=\"keyword\">for</span> segue: UIStoryboardSegue, sender: <span class=\"keyword\">Any</span>?)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 需要给Segue取名</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> segue.identifier == <span class=\"string\">\"GoToGallery\"</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> index = beautyPicker.selectedRow(inComponent: <span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">var</span> imageName: <span class=\"type\">String</span>?</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> index &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">            imageName = <span class=\"string\">\"fangbingbing\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">            imageName = <span class=\"string\">\"libingbing\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">            imageName = <span class=\"string\">\"wangfei\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">            imageName = <span class=\"string\">\"yangmi\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">            imageName = <span class=\"string\">\"zhouxu\"</span></span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            imageName = <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 得到下一个页面的Controller</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> vc = segue.destination <span class=\"keyword\">as</span>! <span class=\"type\">GalleryViewController</span></span><br><span class=\"line\">        vc.imageName = imageName</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"通过图片文件名设置图片\">通过图片文件名设置图片<a href=\"post/ios-study-note#通过图片文件名设置图片\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beautyImage.image = <span class=\"type\">UIImage</span>(named: imageName)</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"unwind-segue关闭页面\">unwind segue关闭页面<a href=\"post/ios-study-note#unwind-segue关闭页面\"></a></h2><p>关闭页面后，Controller可以获得上个页面传回来的值<br>该方法写在前一个页面<br><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">closedPrePage</span><span class=\"params\">(segue: UIStoryboardSegue)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"closed\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure></p>\n<h2 id=\"TableView下移一个状态栏的高度解决\">TableView下移一个状态栏的高度解决<a href=\"post/ios-study-note#TableView下移一个状态栏的高度解决\"></a></h2><ol>\n<li><p>方法一</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> #available(iOS <span class=\"number\">11.0</span>, *) &#123;</span><br><span class=\"line\">    tableView.contentInsetAdjustmentBehavior = .never</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>方法二，内容上部分区域向上偏移一个状态栏的高度</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">collectionView?.contentInset.top = -<span class=\"type\">UIApplication</span>.shared.statusBarFrame.height</span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n<h2 id=\"TableView-添加刷新\">TableView 添加刷新<a href=\"post/ios-study-note#TableView-添加刷新\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> refreshControl = <span class=\"type\">UIRefreshControl</span>()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化刷新</span></span><br><span class=\"line\">refreshControl.backgroundColor = <span class=\"type\">UIColor</span>.blue <span class=\"comment\">//设置刷新的背景颜色</span></span><br><span class=\"line\">refreshControl.attributedTitle = <span class=\"type\">NSAttributedString</span>(string: <span class=\"string\">\"刷新一下：\\(Data())\"</span>, attributes: [<span class=\"type\">NSAttributedStringKey</span>.foregroundColor: <span class=\"type\">UIColor</span>.white]) <span class=\"comment\">// 设置字体颜色</span></span><br><span class=\"line\">refreshControl.tintColor = <span class=\"type\">UIColor</span>.green <span class=\"comment\">// 加载菊花颜色</span></span><br><span class=\"line\">refreshControl.tintAdjustmentMode = .dimmed <span class=\"comment\">// 色彩调整模式</span></span><br><span class=\"line\">refreshControl.addTarget(<span class=\"keyword\">self</span>, action: #selector(addcount), <span class=\"keyword\">for</span>: .valueChanged) <span class=\"comment\">//添加方法目标</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 添加该刷新</span></span><br><span class=\"line\">tableView.refreshControl = refreshControl</span><br></pre></td></tr></table></div></figure>\n<p>刷新方法</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addcount</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    dataArrary.append(contentsOf: dataArrary)</span><br><span class=\"line\">    tableView.reloadData()</span><br><span class=\"line\">    refreshControl.endRefreshing()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"向项目添加字体\">向项目添加字体<a href=\"post/ios-study-note#向项目添加字体\"></a></h2><p><a href=\"https://developer.apple.com/documentation/uikit/text_display_and_fonts/adding_a_custom_font_to_your_app\" target=\"_blank\" rel=\"noopener\">https://developer.apple.com/documentation/uikit/text_display_and_fonts/adding_a_custom_font_to_your_app</a></p>\n<p>由于iOS的用的字体名称并不是文件名称，而是字体本身名称。<br>下面代码搜索所有字体，然后我们在控制台，找到多出来的名称。</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> family: <span class=\"type\">String</span> <span class=\"keyword\">in</span> <span class=\"type\">UIFont</span>.familyNames</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"\\(family)\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> names: <span class=\"type\">String</span> <span class=\"keyword\">in</span> <span class=\"type\">UIFont</span>.fontNames(forFamilyName: family)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"== \\(names)\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"设置tabbar-字体和字体大小\">设置tabbar 字体和字体大小<a href=\"post/ios-study-note#设置tabbar-字体和字体大小\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    <span class=\"keyword\">let</span> appearance = <span class=\"type\">UITabBarItem</span>.appearance()</span><br><span class=\"line\">    appearance.setTitleTextAttributes([<span class=\"type\">NSAttributedStringKey</span>.font: <span class=\"type\">UIFont</span>(name: <span class=\"string\">\"Ubuntu-Light\"</span>, size: <span class=\"number\">9</span>)!], <span class=\"keyword\">for</span>: .normal)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UIButton-相关\">UIButton 相关<a href=\"post/ios-study-note#UIButton-相关\"></a></h2><h3 id=\"UIButton-isEnabled-false后图片按钮的背景图片被改变\">UIButton<code>.isEnabled = false</code>后图片按钮的背景图片被改变<a href=\"post/ios-study-note#UIButton-isEnabled-false后图片按钮的背景图片被改变\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIButton</span>.adjustsImageWhenDisabled = <span class=\"literal\">false</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"扩展添加圆角、边框、边框颜色\">扩展添加圆角、边框、边框颜色<a href=\"post/ios-study-note#扩展添加圆角、边框、边框颜色\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@IBDesignable</span> <span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIButton</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@IBInspectable</span> <span class=\"keyword\">var</span> borderWidth: <span class=\"type\">CGFloat</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123;</span><br><span class=\"line\">            layer.borderWidth = newValue</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> layer.borderWidth</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@IBInspectable</span> <span class=\"keyword\">var</span> cornerRadius: <span class=\"type\">CGFloat</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123;</span><br><span class=\"line\">            layer.cornerRadius = newValue</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> layer.cornerRadius</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@IBInspectable</span> <span class=\"keyword\">var</span> borderColor: <span class=\"type\">UIColor</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">set</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> uiColor = newValue <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">            layer.borderColor = uiColor.cgColor</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">get</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> color = layer.borderColor <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">UIColor</span>(cgColor: color)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"扩展图片在上，文字在下\">扩展图片在上，文字在下<a href=\"post/ios-study-note#扩展图片在上，文字在下\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIButton</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">alignVertical</span><span class=\"params\">(spacing: CGFloat = <span class=\"number\">6.0</span>, imageBottom: CGFloat = <span class=\"number\">0.0</span>)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> imageSize = <span class=\"keyword\">self</span>.imageView?.image?.size,</span><br><span class=\"line\">            <span class=\"keyword\">let</span> text = <span class=\"keyword\">self</span>.titleLabel?.text,</span><br><span class=\"line\">            <span class=\"keyword\">let</span> font = <span class=\"keyword\">self</span>.titleLabel?.font</span><br><span class=\"line\">            <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.titleEdgeInsets = <span class=\"type\">UIEdgeInsets</span>(top: <span class=\"number\">0.0</span>, <span class=\"keyword\">left</span>: -imageSize.width, bottom: -(imageSize.height + spacing), <span class=\"keyword\">right</span>: <span class=\"number\">0.0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> labelString = <span class=\"type\">NSString</span>(string: text)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> titleSize = labelString.size(withAttributes: [<span class=\"type\">NSAttributedStringKey</span>.font: font])</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.imageEdgeInsets = <span class=\"type\">UIEdgeInsets</span>(top: -(titleSize.height + spacing), <span class=\"keyword\">left</span>: <span class=\"number\">0.0</span>, bottom: imageBottom, <span class=\"keyword\">right</span>: -titleSize.width)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> edgeOffset = <span class=\"built_in\">abs</span>(titleSize.height - imageSize.height) / <span class=\"number\">2.0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.contentEdgeInsets = <span class=\"type\">UIEdgeInsets</span>(top: edgeOffset, <span class=\"keyword\">left</span>: <span class=\"number\">0.0</span>, bottom: edgeOffset, <span class=\"keyword\">right</span>: <span class=\"number\">0.0</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"给UIButton图片染色\">给UIButton图片染色<a href=\"post/ios-study-note#给UIButton图片染色\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> button = <span class=\"type\">UIButton</span>(type: .custom)</span><br><span class=\"line\"><span class=\"keyword\">let</span> image = <span class=\"type\">UIImage</span>(named: <span class=\"string\">\"image_name\"</span>)?.withRenderingMode(.alwaysTemplate)</span><br><span class=\"line\">button.setImage(image, <span class=\"keyword\">for</span>: .normal)</span><br><span class=\"line\">button.tintColor = <span class=\"type\">UIColor</span>.red</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UITableView或UICollectionView被TabBar遮盖\">UITableView或UICollectionView被TabBar遮盖<a href=\"post/ios-study-note#UITableView或UICollectionView被TabBar遮盖\"></a></h2><p><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/note-screen1.png\" alt=\"\" class=\"article-img\"></p>\n<h2 id=\"UITableView调用reloadData导致移动到列表顶部失效\">UITableView调用<code>reloadData</code>导致移动到列表顶部失效<a href=\"post/ios-study-note#UITableView调用reloadData导致移动到列表顶部失效\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0</span>, animations: &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.tableView.contentOffset = <span class=\"type\">CGPoint</span>.zero</span><br><span class=\"line\">&#125;, completion: &#123; <span class=\"number\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">self</span>.tableView.reloadData()</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"NavigationBar导致CollectionViewCell或TableViewCell偏移\">NavigationBar导致CollectionViewCell或TableViewCell偏移<a href=\"post/ios-study-note#NavigationBar导致CollectionViewCell或TableViewCell偏移\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">self</span>.collectionView?.contentInsetAdjustmentBehavior = .automatic</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"获取app版本\">获取app版本<a href=\"post/ios-study-note#获取app版本\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// 获取版本名</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> appVersion = <span class=\"type\">Bundle</span>.main.infoDictionary![<span class=\"string\">\"CFBundleShortVersionString\"</span>] <span class=\"keyword\">as</span>? <span class=\"type\">String</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// 获取版本号</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> versionNumber = <span class=\"type\">Bundle</span>.main.infoDictionary![<span class=\"string\">\"CFBundleVersion\"</span>] <span class=\"keyword\">as</span>? <span class=\"type\">String</span></span><br></pre></td></tr></table></div></figure>\n<h2 id=\"打开网页本软件的appstore\">打开网页本软件的appstore<a href=\"post/ios-study-note#打开网页本软件的appstore\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// App Store URL.</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> appStoreLink = <span class=\"string\">\"https://itunes.apple.com/cn/app/id1144351773?mt=8\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* First create a URL, then check whether there is an installed app that can</span></span><br><span class=\"line\"><span class=\"comment\"> open it on the device. */</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> url = <span class=\"type\">URL</span>(string: appStoreLink), <span class=\"type\">UIApplication</span>.shared.canOpenURL(url) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Attempt to open the URL.</span></span><br><span class=\"line\">    <span class=\"type\">UIApplication</span>.shared.<span class=\"keyword\">open</span>(url, options: [:], completionHandler: &#123;(success: <span class=\"type\">Bool</span>) <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> success &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Launching \\(url) was successful\"</span>)</span><br><span class=\"line\">        &#125;&#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"设置圆形展示图像\">设置圆形展示图像<a href=\"post/ios-study-note#设置圆形展示图像\"></a></h2><ol>\n<li>设置<code>UIImageView</code>宽度和高度，假如设置为60*60</li>\n<li>设置运行时属性，设置圆弧为30（正方形边长度一半）<img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/20181102144521.png\" alt=\"\"></li>\n<li>勾选<code>Clip to Bounds</code>，<img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/20181102145029.png\" alt=\"\"></li>\n</ol>\n<h2 id=\"UIScrollView填充到顶部（去掉状态栏到空白间距）\">UIScrollView填充到顶部（去掉状态栏到空白间距）<a href=\"post/ios-study-note#UIScrollView填充到顶部（去掉状态栏到空白间距）\"></a></h2><ol>\n<li><code>Content Insets</code> 选择<code>Never</code></li>\n<li>去掉选中的<code>Safe Area Relative Margins</code><br><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/20181225153159.png\" alt=\"\"></li>\n</ol>\n<h2 id=\"UIImage-高斯模糊扩展\">UIImage 高斯模糊扩展<a href=\"post/ios-study-note#UIImage-高斯模糊扩展\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIImage</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">blurred</span><span class=\"params\">(radius: CGFloat)</span></span> -&gt; <span class=\"type\">UIImage</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> ciContext = <span class=\"type\">CIContext</span>(options: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cgImage = cgImage <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> inputImage = <span class=\"type\">CIImage</span>(cgImage: cgImage)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> ciFilter = <span class=\"type\">CIFilter</span>(name: <span class=\"string\">\"CIGaussianBlur\"</span>) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        ciFilter.setValue(inputImage, forKey: kCIInputImageKey)</span><br><span class=\"line\">        ciFilter.setValue(radius, forKey: <span class=\"string\">\"inputRadius\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> resultImage = ciFilter.value(forKey: kCIOutputImageKey) <span class=\"keyword\">as</span>? <span class=\"type\">CIImage</span> <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cgImage2 = ciContext.createCGImage(resultImage, from: inputImage.extent) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">UIImage</span>(cgImage: cgImage2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"两个UIImage-合并扩展\">两个UIImage 合并扩展<a href=\"post/ios-study-note#两个UIImage-合并扩展\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIImage</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">overlayWith</span><span class=\"params\">(image: UIImage, posX: CGFloat, posY: CGFloat)</span></span> -&gt; <span class=\"type\">UIImage</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newWidth = size.width &lt; posX + image.size.width ? posX + image.size.width : size.width</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newHeight = size.height &lt; posY + image.size.height ? posY + image.size.height : size.height</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newSize = <span class=\"type\">CGSize</span>(width: newWidth, height: newHeight)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">UIGraphicsBeginImageContextWithOptions</span>(newSize, <span class=\"literal\">false</span>, <span class=\"number\">0.0</span>)</span><br><span class=\"line\">    draw(<span class=\"keyword\">in</span>: <span class=\"type\">CGRect</span>(origin: <span class=\"type\">CGPoint</span>.zero, size: size))</span><br><span class=\"line\">    image.draw(<span class=\"keyword\">in</span>: <span class=\"type\">CGRect</span>(origin: <span class=\"type\">CGPoint</span>(x: posX, y: posY), size: image.size))</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newImage = <span class=\"type\">UIGraphicsGetImageFromCurrentImageContext</span>()!</span><br><span class=\"line\">    <span class=\"type\">UIGraphicsEndImageContext</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> newImage</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"SDWebImageView-下载图片\">SDWebImageView 下载图片<a href=\"post/ios-study-note#SDWebImageView-下载图片\"></a></h2><ol>\n<li><p>方式一</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">img.sd_setImage(with: <span class=\"type\">URL</span>(string: <span class=\"string\">\"http://url\"</span>),</span><br><span class=\"line\">  placeholderImage: #imageLiteral(resourceName: <span class=\"string\">\"default_square\"</span>)) &#123; image, error, cacheType, url <span class=\"keyword\">in</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>方式二</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">SDWebImageDownloader</span></span><br><span class=\"line\">  .shared()</span><br><span class=\"line\">  .downloadImage(with: <span class=\"type\">URL</span>(string: <span class=\"string\">\"http://url\"</span>),</span><br><span class=\"line\">    options: <span class=\"type\">SDWebImageDownloaderOptions</span>.<span class=\"keyword\">init</span>(rawValue: <span class=\"number\">0</span>),</span><br><span class=\"line\">    progress: <span class=\"literal\">nil</span>,</span><br><span class=\"line\">    completed: &#123; image, data, error, finished <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> finished &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n<h2 id=\"AVPlayerViewController-视频播放\">AVPlayerViewController 视频播放<a href=\"post/ios-study-note#AVPlayerViewController-视频播放\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> AVKit</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">playVideoByUrl</span><span class=\"params\">(string: String)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> videoURL = <span class=\"type\">URL</span>(string: string)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> player = <span class=\"type\">AVPlayer</span>(url: videoURL!)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> playerViewController = <span class=\"type\">AVPlayerViewController</span>()</span><br><span class=\"line\">    playerViewController.player = player</span><br><span class=\"line\">    <span class=\"keyword\">self</span>.present(playerViewController, animated: <span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">        playerViewController.player!.play()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"为UIImageView添加的点击手势无效\">为UIImageView添加的点击手势无效<a href=\"post/ios-study-note#为UIImageView添加的点击手势无效\"></a></h2><ol>\n<li>勾选上<code>User Interaction Enabled</code><br><img src=\"https://xujiaji.oss-cn-beijing.aliyuncs.com/blog/ios-note/20181226174028.png\" alt=\"\"></li>\n<li>代码中设置<code>uiimageview.userInteractionEnabled = true</code></li>\n</ol>\n<h2 id=\"PHAsset获取文件路径\">PHAsset获取文件路径<a href=\"post/ios-study-note#PHAsset获取文件路径\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">PHAsset</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getURL</span><span class=\"params\">(completionHandler : @escaping <span class=\"params\">(<span class=\"params\">(<span class=\"number\">_</span> responseURL : URL?)</span></span></span></span> -&gt; <span class=\"type\">Void</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.mediaType == .image &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> options: <span class=\"type\">PHContentEditingInputRequestOptions</span> = <span class=\"type\">PHContentEditingInputRequestOptions</span>()</span><br><span class=\"line\">            options.canHandleAdjustmentData = &#123;(adjustmeta: <span class=\"type\">PHAdjustmentData</span>) -&gt; <span class=\"type\">Bool</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.requestContentEditingInput(with: options, completionHandler: &#123;(contentEditingInput: <span class=\"type\">PHContentEditingInput</span>?, info: [<span class=\"type\">AnyHashable</span> : <span class=\"type\">Any</span>]) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                completionHandler(contentEditingInput!.fullSizeImageURL <span class=\"keyword\">as</span> <span class=\"type\">URL</span>?)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.mediaType == .video &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> options: <span class=\"type\">PHVideoRequestOptions</span> = <span class=\"type\">PHVideoRequestOptions</span>()</span><br><span class=\"line\">            options.version = .original</span><br><span class=\"line\">            <span class=\"type\">PHImageManager</span>.<span class=\"keyword\">default</span>().requestAVAsset(forVideo: <span class=\"keyword\">self</span>, options: options, resultHandler: &#123;(asset: <span class=\"type\">AVAsset</span>?, audioMix: <span class=\"type\">AVAudioMix</span>?, info: [<span class=\"type\">AnyHashable</span> : <span class=\"type\">Any</span>]?) -&gt; <span class=\"type\">Void</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> urlAsset = asset <span class=\"keyword\">as</span>? <span class=\"type\">AVURLAsset</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">let</span> localVideoUrl: <span class=\"type\">URL</span> = urlAsset.url <span class=\"keyword\">as</span> <span class=\"type\">URL</span></span><br><span class=\"line\">                    completionHandler(localVideoUrl)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    completionHandler(<span class=\"literal\">nil</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UIView-相关\">UIView 相关<a href=\"post/ios-study-note#UIView-相关\"></a></h2><h3 id=\"通过UIView获取父UIViewController\">通过UIView获取父UIViewController<a href=\"post/ios-study-note#通过UIView获取父UIViewController\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIView</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> parentViewController: <span class=\"type\">UIViewController</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> parentResponder: <span class=\"type\">UIResponder</span>? = <span class=\"keyword\">self</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> parentResponder != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">            parentResponder = parentResponder!.next</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> viewController = parentResponder <span class=\"keyword\">as</span>? <span class=\"type\">UIViewController</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> viewController</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"String-相关\">String 相关<a href=\"post/ios-study-note#String-相关\"></a></h2><h3 id=\"html的字符串，将代码转成对应效果\">html的字符串，将代码转成对应效果<a href=\"post/ios-study-note#html的字符串，将代码转成对应效果\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> htmlToAttributedString: <span class=\"type\">NSAttributedString</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> data = data(using: .utf8) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"type\">NSAttributedString</span>() &#125;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">try</span> <span class=\"type\">NSAttributedString</span>(data: data, options: [.documentType: <span class=\"type\">NSAttributedString</span>.<span class=\"type\">DocumentType</span>.html, .characterEncoding:<span class=\"type\">String</span>.<span class=\"type\">Encoding</span>.utf8.rawValue], documentAttributes: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"type\">NSAttributedString</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> htmlToString: <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> htmlToAttributedString?.string ?? <span class=\"string\">\"\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"正则表达式匹配\">正则表达式匹配<a href=\"post/ios-study-note#正则表达式匹配\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// 正则表达式匹配</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">String</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">matchingStrings</span><span class=\"params\">(regex: String)</span></span> -&gt; [<span class=\"type\">String</span>] &#123;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> regex = <span class=\"keyword\">try</span> <span class=\"type\">NSRegularExpression</span>(pattern: regex)</span><br><span class=\"line\">            <span class=\"keyword\">let</span> results = regex.matches(<span class=\"keyword\">in</span>: <span class=\"keyword\">self</span>,</span><br><span class=\"line\">                                        range: <span class=\"type\">NSRange</span>(<span class=\"keyword\">self</span>.startIndex..., <span class=\"keyword\">in</span>: <span class=\"keyword\">self</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> results.<span class=\"built_in\">map</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span>(<span class=\"keyword\">self</span>[<span class=\"type\">Range</span>($<span class=\"number\">0</span>.range, <span class=\"keyword\">in</span>: <span class=\"keyword\">self</span>)!])</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> <span class=\"keyword\">let</span> error &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"invalid regex: \\(error.localizedDescription)\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> []</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"Data拼接数据\">Data拼接数据<a href=\"post/ios-study-note#Data拼接数据\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Data</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">mutating</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">append</span><span class=\"params\">(<span class=\"number\">_</span> string: String, using encoding: String.Encoding = .utf8)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> data = string.data(using: encoding) &#123;</span><br><span class=\"line\">            append(data)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"打乱数组顺序\">打乱数组顺序<a href=\"post/ios-study-note#打乱数组顺序\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Array</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">mutating</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">randamArray</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> list = <span class=\"keyword\">self</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index <span class=\"keyword\">in</span> <span class=\"number\">0</span>..&lt;list.<span class=\"built_in\">count</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> newIndex = <span class=\"type\">Int</span>(arc4random_uniform(<span class=\"type\">UInt32</span>(list.<span class=\"built_in\">count</span>-index))) + index</span><br><span class=\"line\">            <span class=\"keyword\">if</span> index != newIndex &#123;</span><br><span class=\"line\">                list.swapAt(index, newIndex)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">self</span> = list</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UIImage相关\">UIImage相关<a href=\"post/ios-study-note#UIImage相关\"></a></h2><h3 id=\"高斯模糊图片\">高斯模糊图片<a href=\"post/ios-study-note#高斯模糊图片\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIImage</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">blurred</span><span class=\"params\">(radius: CGFloat)</span></span> -&gt; <span class=\"type\">UIImage</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> ciContext = <span class=\"type\">CIContext</span>(options: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cgImage = cgImage <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> inputImage = <span class=\"type\">CIImage</span>(cgImage: cgImage)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> ciFilter = <span class=\"type\">CIFilter</span>(name: <span class=\"string\">\"CIGaussianBlur\"</span>) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        ciFilter.setValue(inputImage, forKey: kCIInputImageKey)</span><br><span class=\"line\">        ciFilter.setValue(radius, forKey: <span class=\"string\">\"inputRadius\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> resultImage = ciFilter.value(forKey: kCIOutputImageKey) <span class=\"keyword\">as</span>? <span class=\"type\">CIImage</span> <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> cgImage2 = ciContext.createCGImage(resultImage, from: inputImage.extent) <span class=\"keyword\">else</span> &#123; <span class=\"keyword\">return</span> <span class=\"keyword\">self</span> &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">UIImage</span>(cgImage: cgImage2)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"两张图片叠加成一张图片\">两张图片叠加成一张图片<a href=\"post/ios-study-note#两张图片叠加成一张图片\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIImage</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">overlayWith</span><span class=\"params\">(image: UIImage, posX: CGFloat, posY: CGFloat)</span></span> -&gt; <span class=\"type\">UIImage</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newWidth = size.width &lt; posX + image.size.width ? posX + image.size.width : size.width</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newHeight = size.height &lt; posY + image.size.height ? posY + image.size.height : size.height</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newSize = <span class=\"type\">CGSize</span>(width: newWidth, height: newHeight)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">UIGraphicsBeginImageContextWithOptions</span>(newSize, <span class=\"literal\">false</span>, <span class=\"number\">0.0</span>)</span><br><span class=\"line\">        draw(<span class=\"keyword\">in</span>: <span class=\"type\">CGRect</span>(origin: <span class=\"type\">CGPoint</span>.zero, size: size))</span><br><span class=\"line\">        image.draw(<span class=\"keyword\">in</span>: <span class=\"type\">CGRect</span>(origin: <span class=\"type\">CGPoint</span>(x: posX, y: posY), size: image.size))</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newImage = <span class=\"type\">UIGraphicsGetImageFromCurrentImageContext</span>()!</span><br><span class=\"line\">        <span class=\"type\">UIGraphicsEndImageContext</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> newImage</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"缩放图片\">缩放图片<a href=\"post/ios-study-note#缩放图片\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIImage</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">scaled</span><span class=\"params\">(withSize size: CGSize)</span></span> -&gt; <span class=\"type\">UIImage</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">UIGraphicsBeginImageContextWithOptions</span>(size, <span class=\"literal\">false</span>, <span class=\"number\">0.0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">defer</span> &#123; <span class=\"type\">UIGraphicsEndImageContext</span>() &#125;</span><br><span class=\"line\">        draw(<span class=\"keyword\">in</span>: <span class=\"type\">CGRect</span>(x: <span class=\"number\">0.0</span>, y: <span class=\"number\">0.0</span>, width: size.width, height: size.height))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">UIGraphicsGetImageFromCurrentImageContext</span>()!</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"Json相关\">Json相关<a href=\"post/ios-study-note#Json相关\"></a></h2><h3 id=\"Json编码\">Json编码<a href=\"post/ios-study-note#Json编码\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">JSONEncoder</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// 将实体类转换成Json数据</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toJson</span>&lt;T: Encodable&gt;<span class=\"params\">(<span class=\"number\">_</span> entity: T)</span></span> -&gt; <span class=\"type\">String</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> encodedData = <span class=\"keyword\">try</span>? encode(entity) <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">String</span>(data: encodedData, encoding: .utf8)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"Json解码\">Json解码<a href=\"post/ios-study-note#Json解码\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">JSONDecoder</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">from</span>&lt;T: Decodable&gt;<span class=\"params\">(<span class=\"number\">_</span> type: T.<span class=\"keyword\">Type</span>, json: String)</span></span> -&gt; <span class=\"type\">T</span>? &#123;</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">try</span> decode(type, from: json.data(using: .utf8)!)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"请求字段编码为字符串，形式如：key-value-amp-key-value-amp-key-value\">请求字段编码为字符串，形式如：key=value&amp;key=value&amp;key=value<a href=\"post/ios-study-note#请求字段编码为字符串，形式如：key-value-amp-key-value-amp-key-value\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">Dictionary</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">percentEscaped</span><span class=\"params\">()</span></span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">map</span> &#123; (key, value) <span class=\"keyword\">in</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> escapedKey = <span class=\"string\">\"\\(key)\"</span>.addingPercentEncoding(withAllowedCharacters: .urlQueryValueAllowed) ?? <span class=\"string\">\"\"</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> escapedValue = <span class=\"string\">\"\\(value)\"</span>.addingPercentEncoding(withAllowedCharacters: .urlQueryValueAllowed) ?? <span class=\"string\">\"\"</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> escapedKey + <span class=\"string\">\"=\"</span> + escapedValue</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            .joined(separator: <span class=\"string\">\"&amp;\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">CharacterSet</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> urlQueryValueAllowed: <span class=\"type\">CharacterSet</span> = &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> generalDelimitersToEncode = <span class=\"string\">\":#[]@\"</span> <span class=\"comment\">// does not include \"?\" or \"/\" due to RFC 3986 - Section 3.4</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> subDelimitersToEncode = <span class=\"string\">\"!$&amp;'()*+,;=\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> allowed = <span class=\"type\">CharacterSet</span>.urlQueryAllowed</span><br><span class=\"line\">        allowed.remove(charactersIn: <span class=\"string\">\"\\(generalDelimitersToEncode)\\(subDelimitersToEncode)\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> allowed</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"UIViewController-相关\">UIViewController 相关<a href=\"post/ios-study-note#UIViewController-相关\"></a></h2><h3 id=\"添加子UIViewController\">添加子UIViewController<a href=\"post/ios-study-note#添加子UIViewController\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// 添加子ViewController</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addSubController</span><span class=\"params\">(child: UIViewController, to: UIView? = <span class=\"literal\">nil</span>)</span></span> &#123;</span><br><span class=\"line\">        addChildViewController(child)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> to = to &#123;</span><br><span class=\"line\">            child.view.frame = to.frame</span><br><span class=\"line\">            to.addSubview(child.view)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            child.view.frame = view.frame</span><br><span class=\"line\">            view.addSubview(child.view)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        child.didMove(toParentViewController: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"移除子UIViewController\">移除子UIViewController<a href=\"post/ios-study-note#移除子UIViewController\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// 移除子ViewController</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">removeSubController</span><span class=\"params\">(child: UIViewController)</span></span> &#123;</span><br><span class=\"line\">        child.willMove(toParentViewController: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">        child.removeFromParentViewController()</span><br><span class=\"line\">        child.view.removeFromSuperview()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"关闭页面\">关闭页面<a href=\"post/ios-study-note#关闭页面\"></a></h3><h4 id=\"关闭当前页面\">关闭当前页面<a href=\"post/ios-study-note#关闭当前页面\"></a></h4><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/// 关闭当前页面</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">closePage</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.dismiss(animated: <span class=\"literal\">true</span>, completion: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h4 id=\"关闭所有页面，除开最下级的那个页面\">关闭所有页面，除开最下级的那个页面<a href=\"post/ios-study-note#关闭所有页面，除开最下级的那个页面\"></a></h4><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">closeAllPage</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//获取根VC</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> rootVC = <span class=\"keyword\">self</span>.presentingViewController</span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">let</span> parent = rootVC?.presentingViewController &#123;</span><br><span class=\"line\">            rootVC = parent</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//释放所有下级视图</span></span><br><span class=\"line\">        rootVC?.dismiss(animated: <span class=\"literal\">true</span>, completion: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h3 id=\"显示和关闭菊花等待加载\">显示和关闭菊花等待加载<a href=\"post/ios-study-note#显示和关闭菊花等待加载\"></a></h3><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">displaySpinner</span>(<span class=\"title\">onView</span> : <span class=\"title\">UIView</span>) -&gt; <span class=\"title\">UIView</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> spinnerView = <span class=\"type\">UIView</span>.<span class=\"keyword\">init</span>(frame: onView.bounds)</span><br><span class=\"line\">        spinnerView.backgroundColor = <span class=\"type\">UIColor</span>.<span class=\"keyword\">init</span>(red: <span class=\"number\">0.5</span>, green: <span class=\"number\">0.5</span>, blue: <span class=\"number\">0.5</span>, alpha: <span class=\"number\">0.5</span>)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> ai = <span class=\"type\">UIActivityIndicatorView</span>.<span class=\"keyword\">init</span>(activityIndicatorStyle: .whiteLarge)</span><br><span class=\"line\">        ai.startAnimating()</span><br><span class=\"line\">        ai.center = spinnerView.center</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">            spinnerView.addSubview(ai)</span><br><span class=\"line\">            onView.addSubview(spinnerView)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> spinnerView</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">removeSpinner</span>(<span class=\"title\">spinner</span> :<span class=\"title\">UIView</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">            spinner.removeFromSuperview()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>显示</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> sp = <span class=\"type\">UIViewController</span>.displaySpinner(onView: <span class=\"keyword\">self</span>.view)</span><br></pre></td></tr></table></div></figure>\n<blockquote>\n<p>关闭</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIViewController</span>.removeSpinner(spinner: sp)</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"IAP-内购\">IAP 内购<a href=\"post/ios-study-note#IAP-内购\"></a></h2><blockquote>\n<p>使用</p>\n</blockquote>\n<ol>\n<li>除代码外的内购准备工序已OK</li>\n<li>获取产品数据：通过<code>IAPHelper.shared.fetchAvailableProducts</code>从苹果服务器获取所有传入的产品id的产品信息，传入的参数是产品的id字符串数组</li>\n<li><p>支付：<code>IAPHelper.shared.purchase(id: id)</code>，id是产品id</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">IAPHelper</span>.shared.purchase(id: selectItem!.product_id) &#123;alert, product, transaction <span class=\"keyword\">in</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> alert == .purchased &#123; <span class=\"comment\">//购买成功</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> receiptUrl = <span class=\"type\">Bundle</span>.main.appStoreReceiptURL, <span class=\"keyword\">let</span> receiptData = <span class=\"type\">NSData</span>(contentsOf: receiptUrl) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> receiptString = receiptData.base64EncodedString(options: <span class=\"type\">NSData</span>.<span class=\"type\">Base64EncodingOptions</span>(rawValue: <span class=\"number\">0</span>))</span><br><span class=\"line\">          <span class=\"comment\">// 对receiptString加密字符串进行验证</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> alert == .restored &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> alert == .purchasing &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n<blockquote>\n<p>IAPHelper 代码</p>\n</blockquote>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> StoreKit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">IAPHelperAlertType</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> disabled</span><br><span class=\"line\">    <span class=\"keyword\">case</span> restored</span><br><span class=\"line\">    <span class=\"keyword\">case</span> purchased</span><br><span class=\"line\">    <span class=\"keyword\">case</span> purchasing</span><br><span class=\"line\">    <span class=\"keyword\">case</span> setProductIds</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">message</span><span class=\"params\">()</span></span> -&gt; <span class=\"type\">String</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> <span class=\"keyword\">self</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> .setProductIds: <span class=\"keyword\">return</span> <span class=\"string\">\"未设置产品id，请调用 fetchAvailableProducts()\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> .disabled: <span class=\"keyword\">return</span> <span class=\"string\">\"购买已取消\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> .restored: <span class=\"keyword\">return</span> <span class=\"string\">\"您已成功恢复购买\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> .purchased: <span class=\"keyword\">return</span> <span class=\"string\">\"您已成功购买此商品\"</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> .purchasing: <span class=\"keyword\">return</span> <span class=\"string\">\"正在购买...\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IAPHelper</span>: <span class=\"title\">NSObject</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> shared = <span class=\"type\">IAPHelper</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">override</span> <span class=\"keyword\">init</span>() &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fileprivate</span> <span class=\"keyword\">var</span> productID = <span class=\"string\">\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">fileprivate</span> <span class=\"keyword\">var</span> productsRequest = <span class=\"type\">SKProductsRequest</span>()</span><br><span class=\"line\">    <span class=\"keyword\">fileprivate</span> <span class=\"keyword\">var</span> productDict = [<span class=\"type\">String</span>:<span class=\"type\">SKProduct</span>]()</span><br><span class=\"line\">    <span class=\"keyword\">fileprivate</span> <span class=\"keyword\">var</span> fetchProductCompletion: (([<span class=\"type\">SKProduct</span>])-&gt;<span class=\"type\">Void</span>)?</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">fileprivate</span> <span class=\"keyword\">var</span> productToPurchase: <span class=\"type\">SKProduct</span>?</span><br><span class=\"line\">    <span class=\"keyword\">var</span> purchaseProductCompletion: ((<span class=\"type\">IAPHelperAlertType</span>, <span class=\"type\">SKProduct</span>?, <span class=\"type\">SKPaymentTransaction</span>?) -&gt; <span class=\"type\">Void</span>)?</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MARK: - 购买产品</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">canMakePurchases</span><span class=\"params\">()</span></span> -&gt; <span class=\"type\">Bool</span> &#123;  <span class=\"keyword\">return</span> <span class=\"type\">SKPaymentQueue</span>.canMakePayments()  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">purchase</span><span class=\"params\">(id: String, completion: @escaping <span class=\"params\">(<span class=\"params\">(IAPHelperAlertType, SKProduct?, SKPaymentTransaction?)</span></span></span></span>-&gt;<span class=\"type\">Void</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.purchaseProductCompletion = completion</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.productToPurchase = productDict[id]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> product = <span class=\"keyword\">self</span>.productToPurchase <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"type\">IAPHelperAlertType</span>.setProductIds.message())</span><br><span class=\"line\">            <span class=\"built_in\">fatalError</span>(<span class=\"type\">IAPHelperAlertType</span>.setProductIds.message())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">self</span>.canMakePurchases() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> payment = <span class=\"type\">SKPayment</span>(product: product)</span><br><span class=\"line\">            <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().add(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">            <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().add(payment)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"采购产品: \\(product.productIdentifier)\"</span>)</span><br><span class=\"line\">            productID = product.productIdentifier</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            completion(.disabled, <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MARK: - 恢复购买</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">restorePurchase</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().add(<span class=\"keyword\">self</span>)</span><br><span class=\"line\">        <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().restoreCompletedTransactions()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MARK: - 获取可用的iap产品</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fetchAvailableProducts</span><span class=\"params\">(by ids: [String], completion: @escaping <span class=\"params\">(<span class=\"params\">([SKProduct])</span></span></span></span>-&gt;<span class=\"type\">Void</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.fetchProductCompletion = completion</span><br><span class=\"line\">        <span class=\"comment\">// 把您的IAP产品id放到这里面</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">guard</span> !ids.isEmpty <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"没有设置产品id\"</span>)</span><br><span class=\"line\">            <span class=\"built_in\">fatalError</span>(<span class=\"type\">IAPHelperAlertType</span>.setProductIds.message())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        productsRequest = <span class=\"type\">SKProductsRequest</span>(productIdentifiers: <span class=\"type\">Set</span>(ids))</span><br><span class=\"line\">        productsRequest.delegate = <span class=\"keyword\">self</span></span><br><span class=\"line\">        productsRequest.start()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">IAPHelper</span>: <span class=\"title\">SKProductsRequestDelegate</span>, <span class=\"title\">SKPaymentTransactionObserver</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// MARK: - 请求IAP产品</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">productsRequest</span> <span class=\"params\">(<span class=\"number\">_</span> request:SKProductsRequest, didReceive response:SKProductsResponse)</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (response.products.<span class=\"built_in\">count</span> &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> product <span class=\"keyword\">in</span> response.products &#123;</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">\"product.productIdentifier = \\(product.productIdentifier)\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.productDict[product.productIdentifier] = product</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.fetchProductCompletion?(response.products)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">paymentQueueRestoreCompletedTransactionsFinished</span><span class=\"params\">(<span class=\"number\">_</span> queue: SKPaymentQueue)</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.purchaseProductCompletion?(.restored, <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// MARK:- IAP付款队列</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">paymentQueue</span><span class=\"params\">(<span class=\"number\">_</span> queue: SKPaymentQueue, updatedTransactions transactions: [SKPaymentTransaction])</span></span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"调用了几次啊！！！\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> transaction:<span class=\"type\">AnyObject</span> <span class=\"keyword\">in</span> transactions &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> trans = transaction <span class=\"keyword\">as</span>? <span class=\"type\">SKPaymentTransaction</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">switch</span> trans.transactionState &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> .purchased:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">\"产品已购买\"</span>)</span><br><span class=\"line\">                    <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().finishTransaction(transaction <span class=\"keyword\">as</span>! <span class=\"type\">SKPaymentTransaction</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.purchaseProductCompletion?(.purchased, <span class=\"keyword\">self</span>.productToPurchase, trans)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">case</span> .failed:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">\"产品购买失败\\(trans.error.debugDescription)\"</span>)</span><br><span class=\"line\">                    <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().finishTransaction(transaction <span class=\"keyword\">as</span>! <span class=\"type\">SKPaymentTransaction</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.purchaseProductCompletion?(.disabled, <span class=\"keyword\">self</span>.productToPurchase, trans)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"keyword\">case</span> .purchasing:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">\"正在购买...\"</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.purchaseProductCompletion?(.purchasing, <span class=\"keyword\">self</span>.productToPurchase, trans)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\">                <span class=\"keyword\">case</span> .restored:</span><br><span class=\"line\">                    <span class=\"built_in\">print</span>(<span class=\"string\">\"产品已恢复购买\"</span>)</span><br><span class=\"line\">                    <span class=\"type\">SKPaymentQueue</span>.<span class=\"keyword\">default</span>().finishTransaction(transaction <span class=\"keyword\">as</span>! <span class=\"type\">SKPaymentTransaction</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">self</span>.purchaseProductCompletion?(.restored, <span class=\"keyword\">self</span>.productToPurchase, trans)</span><br><span class=\"line\">                    <span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">default</span>: <span class=\"keyword\">break</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"判断退格符”-b”\">判断退格符”\\b”<a href=\"post/ios-study-note#判断退格符”-b”\"></a></h2><p><a href=\"https://stackoverflow.com/a/29505548/9724892\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/a/29505548/9724892</a></p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">textField</span><span class=\"params\">(textField: UITextField, shouldChangeCharactersInRange range: NSRange, replacementString string: String)</span></span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> char = string.cString(using: <span class=\"type\">String</span>.<span class=\"type\">Encoding</span>.utf8) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> isBackSpace = strcmp(char, <span class=\"string\">\"\\\\b\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isBackSpace == -<span class=\"number\">92</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Backspace was pressed\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"CocoaPods单独为一些库设置版本\">CocoaPods单独为一些库设置版本<a href=\"post/ios-study-note#CocoaPods单独为一些库设置版本\"></a></h2><p>在Podfile末尾加入</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swift_versions_of_pods = &#123; 'swiftScan' =&gt; '<span class=\"number\">4.0</span>', '<span class=\"type\">CWActionSheet'</span> =&gt; '<span class=\"number\">4.0</span>' &#125;</span><br><span class=\"line\">post_install <span class=\"keyword\">do</span> |installer|</span><br><span class=\"line\">  installer.pods_project.targets.each <span class=\"keyword\">do</span> |target|</span><br><span class=\"line\">    defined_swift_version = swift_versions_of_pods[target.name]</span><br><span class=\"line\">    next <span class=\"keyword\">if</span> defined_swift_version.blank?</span><br><span class=\"line\">    target.build_configurations.each <span class=\"keyword\">do</span> |config|</span><br><span class=\"line\">      config.build_settings['<span class=\"type\">SWIFT_VERSION'</span>] = defined_swift_version</span><br><span class=\"line\">    end</span><br><span class=\"line\">  end</span><br><span class=\"line\">end</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"代码中为label添加点击事件\">代码中为label添加点击事件<a href=\"post/ios-study-note#代码中为label添加点击事件\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    <span class=\"keyword\">let</span> tap = <span class=\"type\">UITapGestureRecognizer</span>(target: <span class=\"keyword\">self</span>, action: #selector(tapFunction))</span><br><span class=\"line\">    label.isUserInteractionEnabled = <span class=\"literal\">true</span></span><br><span class=\"line\">    label.addGestureRecognizer(tap)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tapFunction</span><span class=\"params\">(sender: UITapGestureRecognizer)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"tap working\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<h2 id=\"需要给手势传入额外的数据\">需要给手势传入额外的数据<a href=\"post/ios-study-note#需要给手势传入额外的数据\"></a></h2><ol>\n<li><p>创建一个tap手势子类</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TopicUITapGestureRecognizer</span> : <span class=\"title\">UITapGestureRecognizer</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> id = <span class=\"type\">Int</span>()</span><br><span class=\"line\">    <span class=\"keyword\">var</span> title = <span class=\"type\">String</span>()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>处理数据</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tapFunction</span><span class=\"params\">(sender: TopicUITapGestureRecognizer)</span></span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"点击了: \\(sender.id), \\(sender.title)\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n</li>\n<li><p>添加事件设置数据</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> tap = <span class=\"type\">TopicUITapGestureRecognizer</span>(target: <span class=\"keyword\">self</span>, action: #selector(tapFunction))</span><br><span class=\"line\">tap.id = topic.id ?? <span class=\"number\">0</span></span><br><span class=\"line\">tap.title = topic.topic ?? <span class=\"string\">\"\"</span></span><br><span class=\"line\">label.isUserInteractionEnabled = <span class=\"literal\">true</span></span><br><span class=\"line\">label.addGestureRecognizer(tap)</span><br></pre></td></tr></table></div></figure>\n</li>\n</ol>\n<h2 id=\"当Swift的枚举类型传入数组到OC中时报错\">当Swift的枚举类型传入数组到OC中时报错<a href=\"post/ios-study-note#当Swift的枚举类型传入数组到OC中时报错\"></a></h2><p>异常信息</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">'<span class=\"type\">NSInvalidArgumentException'</span>, reason: '-[__SwiftValue iconNormal]: unrecognized</span><br></pre></td></tr></table></div></figure>\n<p>解决: 传入枚举类型<code>.rawValue</code></p>\n<p><a href=\"https://stackoverflow.com/questions/39643394/swift-3-error-swiftvalue-unsignedintegervalue-unrecognized-selector/\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/39643394/swift-3-error-swiftvalue-unsignedintegervalue-unrecognized-selector/</a></p>\n<h2 id=\"获取App缓存大小、清理App缓存\">获取App缓存大小、清理App缓存<a href=\"post/ios-study-note#获取App缓存大小、清理App缓存\"></a></h2><figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AppCacheCleanUtil</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// 获取app缓存大小</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getCacheSize</span><span class=\"params\">()</span></span> -&gt; <span class=\"type\">String</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 取出cache文件夹目录</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> cachePath = <span class=\"type\">NSSearchPathForDirectoriesInDomains</span>(.cachesDirectory, .userDomainMask, <span class=\"literal\">true</span>).first</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 取出文件夹下所有文件数组</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> fileArr = <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.subpaths(atPath: cachePath!)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//快速枚举出所有文件名 计算文件大小</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> size = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> fileArr! &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 把文件名拼接到路径中</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> path = cachePath! + (<span class=\"string\">\"/\\(file)\"</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 取出文件属性</span></span><br><span class=\"line\">            <span class=\"keyword\">let</span> floder = <span class=\"keyword\">try</span>! <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.attributesOfItem(atPath: path)</span><br><span class=\"line\">            <span class=\"comment\">// 用元组取出文件大小属性</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (key, fileSize) <span class=\"keyword\">in</span> floder &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 累加文件大小</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> key == <span class=\"type\">FileAttributeKey</span>.size &#123;</span><br><span class=\"line\">                    size += (fileSize <span class=\"keyword\">as</span> <span class=\"type\">AnyObject</span>).integerValue</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> totalCache = <span class=\"type\">Double</span>(size) / <span class=\"number\">1024.00</span> / <span class=\"number\">1024.00</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"type\">String</span>(format: <span class=\"string\">\"%.2f\"</span>, totalCache)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// 清理app缓存文件</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">clearCache</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> cachePath = <span class=\"type\">NSSearchPathForDirectoriesInDomains</span>(.cachesDirectory, .userDomainMask, <span class=\"literal\">true</span>).first</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 取出文件夹下所有文件数组</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> fileArr = <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.subpaths(atPath: cachePath!)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 遍历删除</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> file <span class=\"keyword\">in</span> fileArr! &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> path = cachePath?.appendingFormat(<span class=\"string\">\"/\\(file)\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.fileExists(atPath: path!) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">try</span> <span class=\"type\">FileManager</span>.<span class=\"keyword\">default</span>.removeItem(atPath: path!)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n","prev":{"title":"iOS用UISegmentedControl设计一个顶部分页导航-Swift（翻译文）","link":"post/ios-uisegmented-design"},"next":{"title":"Swift学习笔记","link":"post/swift-study-note"},"plink":"https://blog.xujiaji.com/post/ios-study-note/","toc":[{"title":"iOS开发-零碎笔记","id":"iOS开发-零碎笔记","index":"1","children":[{"title":"创建项目目录结构","id":"创建项目目录结构","index":"1.1"},{"title":"快捷添加注释","id":"快捷添加注释","index":"1.2"},{"title":"关闭软键盘","id":"关闭软键盘","index":"1.3"},{"title":"UIDatePicker选择时间后计算年龄","id":"UIDatePicker选择时间后计算年龄","index":"1.4"},{"title":"页面跳转，传递数据","id":"页面跳转，传递数据","index":"1.5"},{"title":"通过图片文件名设置图片","id":"通过图片文件名设置图片","index":"1.6"},{"title":"unwind segue关闭页面","id":"unwind-segue关闭页面","index":"1.7"},{"title":"TableView下移一个状态栏的高度解决","id":"TableView下移一个状态栏的高度解决","index":"1.8"},{"title":"TableView 添加刷新","id":"TableView-添加刷新","index":"1.9"},{"title":"向项目添加字体","id":"向项目添加字体","index":"1.10"},{"title":"设置tabbar 字体和字体大小","id":"设置tabbar-字体和字体大小","index":"1.11"},{"title":"UIButton 相关","id":"UIButton-相关","index":"1.12","children":[{"title":"UIButton<code>.isEnabled = false</code>后图片按钮的背景图片被改变","id":"UIButton-isEnabled-false后图片按钮的背景图片被改变","index":"1.12.1"},{"title":"扩展添加圆角、边框、边框颜色","id":"扩展添加圆角、边框、边框颜色","index":"1.12.2"},{"title":"扩展图片在上，文字在下","id":"扩展图片在上，文字在下","index":"1.12.3"},{"title":"给UIButton图片染色","id":"给UIButton图片染色","index":"1.12.4"}]},{"title":"UITableView或UICollectionView被TabBar遮盖","id":"UITableView或UICollectionView被TabBar遮盖","index":"1.13"},{"title":"UITableView调用<code>reloadData</code>导致移动到列表顶部失效","id":"UITableView调用reloadData导致移动到列表顶部失效","index":"1.14"},{"title":"NavigationBar导致CollectionViewCell或TableViewCell偏移","id":"NavigationBar导致CollectionViewCell或TableViewCell偏移","index":"1.15"},{"title":"获取app版本","id":"获取app版本","index":"1.16"},{"title":"打开网页本软件的appstore","id":"打开网页本软件的appstore","index":"1.17"},{"title":"设置圆形展示图像","id":"设置圆形展示图像","index":"1.18"},{"title":"UIScrollView填充到顶部（去掉状态栏到空白间距）","id":"UIScrollView填充到顶部（去掉状态栏到空白间距）","index":"1.19"},{"title":"UIImage 高斯模糊扩展","id":"UIImage-高斯模糊扩展","index":"1.20"},{"title":"两个UIImage 合并扩展","id":"两个UIImage-合并扩展","index":"1.21"},{"title":"SDWebImageView 下载图片","id":"SDWebImageView-下载图片","index":"1.22"},{"title":"AVPlayerViewController 视频播放","id":"AVPlayerViewController-视频播放","index":"1.23"},{"title":"为UIImageView添加的点击手势无效","id":"为UIImageView添加的点击手势无效","index":"1.24"},{"title":"PHAsset获取文件路径","id":"PHAsset获取文件路径","index":"1.25"},{"title":"UIView 相关","id":"UIView-相关","index":"1.26","children":[{"title":"通过UIView获取父UIViewController","id":"通过UIView获取父UIViewController","index":"1.26.1"}]},{"title":"String 相关","id":"String-相关","index":"1.27","children":[{"title":"html的字符串，将代码转成对应效果","id":"html的字符串，将代码转成对应效果","index":"1.27.1"},{"title":"正则表达式匹配","id":"正则表达式匹配","index":"1.27.2"}]},{"title":"Data拼接数据","id":"Data拼接数据","index":"1.28"},{"title":"打乱数组顺序","id":"打乱数组顺序","index":"1.29"},{"title":"UIImage相关","id":"UIImage相关","index":"1.30","children":[{"title":"高斯模糊图片","id":"高斯模糊图片","index":"1.30.1"},{"title":"两张图片叠加成一张图片","id":"两张图片叠加成一张图片","index":"1.30.2"},{"title":"缩放图片","id":"缩放图片","index":"1.30.3"}]},{"title":"Json相关","id":"Json相关","index":"1.31","children":[{"title":"Json编码","id":"Json编码","index":"1.31.1"},{"title":"Json解码","id":"Json解码","index":"1.31.2"}]},{"title":"请求字段编码为字符串，形式如：key=value&amp;key=value&amp;key=value","id":"请求字段编码为字符串，形式如：key-value-amp-key-value-amp-key-value","index":"1.32"},{"title":"UIViewController 相关","id":"UIViewController-相关","index":"1.33","children":[{"title":"添加子UIViewController","id":"添加子UIViewController","index":"1.33.1"},{"title":"移除子UIViewController","id":"移除子UIViewController","index":"1.33.2"},{"title":"关闭页面","id":"关闭页面","index":"1.33.3"},{"title":"显示和关闭菊花等待加载","id":"显示和关闭菊花等待加载","index":"1.33.4"}]},{"title":"IAP 内购","id":"IAP-内购","index":"1.34"},{"title":"判断退格符”\\b”","id":"判断退格符”-b”","index":"1.35"},{"title":"CocoaPods单独为一些库设置版本","id":"CocoaPods单独为一些库设置版本","index":"1.36"},{"title":"代码中为label添加点击事件","id":"代码中为label添加点击事件","index":"1.37"},{"title":"需要给手势传入额外的数据","id":"需要给手势传入额外的数据","index":"1.38"},{"title":"当Swift的枚举类型传入数组到OC中时报错","id":"当Swift的枚举类型传入数组到OC中时报错","index":"1.39"},{"title":"获取App缓存大小、清理App缓存","id":"获取App缓存大小、清理App缓存","index":"1.40"}]}],"reward":true,"copyright":{"author":"xujiaji","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","link":"<a href=\"https://blog.xujiaji.com/post/ios-study-note/\" title=\"iOS开发-零碎笔记\">https://blog.xujiaji.com/post/ios-study-note/</a>"}}